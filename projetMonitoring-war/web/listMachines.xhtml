<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:p="http://primefaces.org/ui">

    <body>

        <ui:composition template="./resources/templateMonitoring.xhtml">

            <ui:define name="content">
                <f:view>


                    <h:form id="form">
                        <p:growl id="growl" sticky="true" showDetail="true" life="2000" />
                        <p:dataTable  value="#{beansMachine.listMachines}" var="item" resizableColumns="true" liveResize="true" draggableColumns="true">
                            <f:facet name="header">
                                Liste des machines supervisées
                            </f:facet>
                            <p:column style="text-align: center; width:190px">
                                <f:facet name="header">
                                    <h:outputText value="Fonctions"/>
                                </f:facet>
                                <p:commandButton icon="ui-icon-pencil" action="#{beanModifierMachine.pageModifieMachine(item.adresseIP)}" title="Editer Machine"/>
                                <p:commandButton icon="ui-icon-check" title="Tester l'agent" action="#{beansMachine.testerAgent(item)}" ajax="true" update=":form" />
                                <p:commandButton icon="ui-icon-play" title="Démarrer la supervision ou là rafraichi" action="#{beansMachine.demarerOuRedemarerMachine(item)}" ajax="true" update=":form" />
                                <p:commandButton icon="ui-icon-stop" title="arrêter la supervision" action="#{beansMachine.stoperMachine(item)}" ajax="true" update=":form" />
                                <p:commandButton update=":form:machineParam" oncomplete="PF('parametreMachine').show()" icon="ui-icon-search" title="Aperçu des taches">
                                    <f:setPropertyActionListener value="#{item}" target="#{beansMachine.machine}" />
                                </p:commandButton>
                                <p:commandButton icon="ui-icon-closethick" title="supprimer la machine" actionListener="#{beansMachine.suprimerMachine(item)}" update="form">
                                    <p:confirm header="Confirmation" message="Voulez-vous vraiment supprimer la machine :#{item.adresseIP} ? Toute les taches associées seront aussi supprimées " icon="ui-icon-alert" />
                                </p:commandButton>

                                <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                                    <p:commandButton value="Oui" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
                                    <p:commandButton value="Non" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
                                </p:confirmDialog>
                            </p:column>

                            <p:column style="text-align: center; width:20px">
                                <f:facet name="header">
                                    <h:outputText value="Id"/>
                                </f:facet>
                                <h:outputText value="#{item.idMachine}"/>
                            </p:column>
                            <p:column sortBy="#{item.adresseIP}" style="width:90px">
                                <f:facet name="header">
                                    <h:outputText value="Adresse IP"/>
                                </f:facet>
                                <h:outputText value="#{item.adresseIP}"/>
                            </p:column>
                            <p:column sortBy="#{item.portEcoute}" style="width:40px">
                                <f:facet name="header">
                                    <h:outputText value="Port" title="Le port d'écouter : le port par le quelle le serveur vas communiquer avec la machine"/>
                                </f:facet>
                                <h:outputText value="#{item.portEcoute}"/>
                            </p:column>
                            <p:column sortBy="#{item.nomMachine}" filterBy="#{item.nomMachine}" style="width:105px">
                                <f:facet name="header">
                                    <h:outputText value="Nom machine"/>
                                </f:facet>
                                <h:outputText value="#{item.nomMachine}"/>
                            </p:column>
                            <p:column sortBy="#{item.typeOS}" style="width:70px">
                                <f:facet name="header">
                                    <h:outputText value="Type OS"/>
                                </f:facet>
                                <h:outputText value="#{item.typeOS}"/>
                            </p:column>
                            <p:column sortBy="#{item.descriptionDeLaPeriode}">
                                <f:facet name="header">
                                    <h:outputText value="Periode" title="Période de vérification du bon fonctionnement des taches et la période de rappel des alertes"/>
                                </f:facet>
                                <h:outputText value="#{item.descriptionDeLaPeriode}"/>
                            </p:column>
                            <p:column sortBy="#{item.statut}" filterBy="#{item.statut}" >
                                <f:facet name="header">
                                    <h:outputText value="Statut"/>
                                </f:facet>
                                <h:outputText title="#{item.statut}" value="#{item.statut}" style="font-weight:bold;color: #{beanVariableGlobal.couleurStatut(item.statut)}"/>
                            </p:column>
                            <p:column sortBy="#{item.niveauDAlerte}" style="width:50px">
                                <f:facet name="header">
                                    <h:outputText value="Niveau" title="niveau d'alerte de la machine"/>
                                </f:facet>
                                <h:outputText value="#{item.niveauDAlerte}"/>


                            </p:column>



                        </p:dataTable>
                        <p:dialog header="Détails machine" widgetVar="parametreMachine" dynamic="true" modal="false" showEffect="fade" hideEffect="fade" resizable="true" width="640" height="340">
                            <p:outputPanel id="machineParam" style="text-align:center;">
                                <p:panelGrid columns="2">
                                    <p:commandButton value="Plus de détails" action="#{beanListeTachesMachine.chargerPage(beansMachine.machine.adresseIP)}"/>
                                    <p:commandButton icon="ui-icon-circle-plus" title="créer une tache sur cette machine" action="#{beanCreerTache.pageCreerTache(beansMachine.machine.adresseIP)}"/>

                                </p:panelGrid>

                                <p:panelGrid  columns="2"  rendered="#{not empty beansMachine.machine}" columnClasses="label,value">

                                    <h:form>
                                        <p:dataTable value="#{beansMachine.listTache}" resizableColumns="true" var="item">
                                            <f:facet name="header">
                                                Tâches de la machine: #{beansMachine.machine.adresseIP}
                                            </f:facet>

                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputText value="SeuilAlerte"/>
                                                </f:facet>
                                                <h:outputText value="#{item.seuilAlerte}"/>
                                            </p:column>
                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputText value="Nom"/>
                                                </f:facet>
                                                <h:outputText value="#{item.nom}"/>
                                            </p:column>

                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputText value="PeriodeVerrification"/>
                                                </f:facet>
                                                <h:outputText value="#{item.periodeVerrification}"/>
                                            </p:column>
                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputText value="TypeTache"/>
                                                </f:facet>
                                                <h:outputText value="#{item.typeTache}"/>
                                            </p:column>
                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputText value="EnvoiyerAlerteMail"/>
                                                </f:facet>
                                                <h:outputText value="#{item.envoiyerAlerteMail}"/>
                                            </p:column>
                                            <p:column>
                                                <f:facet name="header">
                                                    <h:outputText value="EnvoyerAlerteSms"/>
                                                </f:facet>
                                                <h:outputText value="#{item.envoyerAlerteSms}"/>
                                            </p:column>
                                            <p:column >
                                                <f:facet name="header">
                                                    <h:outputText title="Niveau d'alerte de la tache" value="Niveau"/>
                                                </f:facet>
                                                <h:outputText value="#{item.niveauDAlerte}"/>
                                            </p:column>

                                        </p:dataTable>
                                    </h:form>
                                </p:panelGrid>

                            </p:outputPanel>
                        </p:dialog>

                    </h:form>
                </f:view>

            </ui:define>

        </ui:composition>

    </body>
</html>
